{"version":3,"sources":["../lib/typer.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;eAGI,QAAQ,UAAR,C;;IAFF,S,YAAA,S;IACA,U,YAAA,U;;;AAGF,IAAM,gBAAgB,CACpB,EAAC,KAAK,aAAN,EAAqB,MAAM,QAA3B,EADoB,EAEpB,EAAC,KAAK,OAAN,EAAe,MAAM,QAArB,EAFoB,EAGpB,EAAC,KAAK,UAAN,EAAkB,MAAM,SAAxB,EAAmC,SAAS,IAA5C,EAHoB,CAAtB;;;;;;;;AAYA,IAAM,aAAa,SAAb,UAAa,CAAC,QAAD,EAAY;AAC7B,MAAG,OAAO,QAAP,KAAqB,QAAxB,EAAiC;AAC/B,WAAO;AACL,YAAM,QADD;AAEL,WAAK;AAFA,KAAP;AAID;AACD,SAAO,QAAP;AACD,CARD;;AAUA,IAAM,cAAc,SAAd,WAAc,CAAC,QAAD,EAAW,KAAX,EAAkB,GAAlB,EAAwB;AAC1C,MAAM,MAAM,IAAI,SAAJ,CAAc,UAAC,IAAD;AAAA,WAAQ,KAAK,GAAL,KAAW,SAAS,GAA5B;AAAA,GAAd,CAAZ;AACA,SAAO,QAAQ,KAAf;AACD,CAHD;;IAKa,Q,WAAA,Q;;;;;;;+BACgB;AAAA,UAAlB,UAAkB,yDAAL,IAAK;;AACzB,aAAO,KAAK,QAAL,CAAc,CAAC,UAAf,CAAP;AACD;;;;;;AACF;;AAEM,IAAM,gCAAY,SAAZ,SAAY,CAAC,IAAD,EAAO,KAAP,EAAiC;AAAA,MAAnB,WAAmB,yDAAL,EAAK;;;AAExD,MAAM,WAAW,GAAG,MAAH,CAAU,MAAM,GAAN,CAAU,UAAV,CAAV,EAAiC,YAAY,YAAZ,IAA4B,EAA7D,EAAiE,aAAjE,EAAgF,MAAhF,CAAuF,WAAvF,CAAjB;AACA,MAAM,WAAW,SAAS,MAAT,CAAgB,UAAC,IAAD;AAAA,WAAQ,KAAK,OAAL,KAAiB,KAAK,CAA9B;AAAA,GAAhB,EAAiD,GAAjD,CAAqD,UAAC,IAAD,EAAQ;AAAA,QAE1E,GAF0E,GAIxE,IAJwE,CAE1E,GAF0E;AAAA,QAG/D,KAH+D,GAIxE,IAJwE,CAG1E,SAH0E;;AAK5E,WAAO;AACL,cADK;AAEL;AAFK,KAAP;AAID,GATgB,CAAjB;;AAHwD,MAclD,OAdkD;AAAA;;AAetD,uBAAmC;AAAA,UAAvB,KAAuB,yDAAf,EAAe;AAAA,UAAX,OAAW,yDAAH,EAAG;;AAAA;;AAAA,6FAC3B,KAD2B,EACpB,OADoB;;AAEjC,UAAG,YAAY,WAAf,EAA2B;AACzB,gBAAQ,YAAY,WAAZ,CAAwB,KAAxB,QAAoC,SAApC,CAAR;AACD;AACD,YAAK,IAAL,GAAY,IAAZ;AACA,UAAM,eAAe,SAAS,MAAT,CAAgB,UAAC,GAAD,EAAM,GAAN,EAAY;AAC/C,YAAI,IAAI,GAAR,IAAe,IAAI,KAAnB;AACA,eAAO,GAAP;AACD,OAHoB,EAGlB,EAHkB,CAArB;AAIA,YAAK,KAAL,GAAa,OAAO,MAAP,CAAc,YAAd,EAA4B,KAA5B,CAAb;;AAViC;AAYlC;;AA3BqD;AAAA;AAAA,+BA6B9C;AACN,eAAO,OAAO,MAAP,CAAc,EAAd,EAAkB,KAAK,KAAvB,EAA8B,EAAC,MAAM,KAAK,IAAZ,EAA9B,CAAP;AACD;AA/BqD;AAAA;AAAA,iCAiC5C;AACR,eAAO,KAAK,SAAL,CAAe,OAAO,MAAP,CAAc,EAAd,EAAkB,KAAK,KAAvB,EAA8B,EAAC,MAAM,KAAK,IAAZ,EAA9B,CAAf,EAAiE,IAAjE,EAAuE,IAAvE,CAAP;AACD;AAnCqD;;AAAA;AAAA,IAclC,QAdkC;;AAoCvD;;AAED,WAAS,OAAT,CAAiB,UAAC,IAAD,EAAQ;AAAA,qBAMnB,IANmB,CAErB,IAFqB;AAAA,QAErB,IAFqB,8BAEd,QAFc;AAAA,QAGrB,GAHqB,GAMnB,IANmB,CAGrB,GAHqB;AAAA,oBAMnB,IANmB,CAIrB,GAJqB;AAAA,QAIrB,GAJqB,6BAIf,KAJe;AAAA,oBAMnB,IANmB,CAKrB,GALqB;AAAA,QAKrB,GALqB,6BAKf,KALe;;;AAQvB,WAAO,QAAQ,SAAR,CAAkB,GAAlB,IAAyB,UAAS,KAAT,EAAe;AAC7C,UAAM,mBAAmB,KAAnB,yCAAmB,KAAnB,CAAN;AACA,UAAG,cAAc,KAAK,IAAtB,EAA2B;AACzB,cAAM,IAAI,SAAJ,CAAc,IAAd,EAAoB,SAApB,CAAN;AACD;AACD,UAAG,QAAQ,KAAR,IAAiB,QAAQ,GAA5B,EAAgC;AAC9B,cAAM,IAAI,UAAJ,CAAe,2BAAf,EAA4C,KAA5C,EAAmD,GAAnD,CAAN;AACD;AACD,UAAG,QAAQ,KAAR,IAAiB,QAAQ,GAA5B,EAAgC;AAC9B,cAAM,IAAI,UAAJ,CAAe,8BAAf,EAA+C,KAA/C,EAAsD,GAAtD,CAAN;AACD;AACD,aAAO,IAAI,OAAJ,CAAY,OAAO,MAAP,CAAc,EAAd,EAAkB,KAAK,KAAvB,sBAAgC,GAAhC,EAAsC,KAAtC,EAAZ,CAAP;AACD,KAZD;AAaD,GArBD;;AAuBA,SAAO,OAAP;AACD,CA9DM","file":"typer.js","sourcesContent":["const {\n  TypeError,\n  RangeError,\n} = require('./errors');\n\nconst DEFAULT_TYPES = [\n  {key: 'description', type: 'string'},\n  {key: 'notes', type: 'string'},\n  {key: 'required', type: 'boolean', default: true},\n];\n\n/*\nconst DEFAULT_PREFIXES = {\n  '*': {required: false},\n};\n*/\n\nconst toFullType = (typeInfo)=>{\n  if(typeof(typeInfo) === 'string'){\n    return {\n      type: 'string',\n      key: typeInfo\n    };\n  }\n  return typeInfo;\n};\n\nconst uniqueTypes = (typeInfo, index, arr)=>{\n  const idx = arr.findIndex((elem)=>elem.key===typeInfo.key);\n  return idx === index;\n};\n\nexport class KoelType{\n  optional(isOptional = true){\n    return this.required(!isOptional);\n  }\n};\n\nexport const KoelTyper = (type, types, baseOptions = {})=>{\n  //const prefixes = Object.assign({}, DEFAULT_PREFIXES, baseOptions.prefixes || {});\n  const objTypes = [].concat(types.map(toFullType), baseOptions.defaultTypes || [], DEFAULT_TYPES).filter(uniqueTypes);\n  const defaults = objTypes.filter((info)=>info.default !== void 0).map((info)=>{\n    const {\n      key,\n      'default': value\n    } = info;\n    return {\n      key,\n      value\n    };\n  });\n\n  class Handler extends KoelType{\n    constructor(props = {}, options={}){\n      super(props, options);\n      if(baseOptions.constructor){\n        props = baseOptions.constructor.apply(this, arguments);\n      }\n      this.type = type;\n      const defaultProps = defaults.reduce((obj, def)=>{\n        obj[def.key] = def.value;\n        return obj;\n      }, {});\n      this.props = Object.assign(defaultProps, props);\n      //this.prefixes = prefixes;\n    }\n\n    toJSON(){\n      return Object.assign({}, this.props, {type: this.type});\n    }\n\n    toString(){\n      return JSON.stringify(Object.assign({}, this.props, {type: this.type}), null, '  ');\n    }\n  };\n\n  objTypes.forEach((info)=>{\n    const {\n      type = 'string',\n      key,\n      min = false,\n      max = false,\n    } = info;\n\n    return Handler.prototype[key] = function(value){\n      const valueType = typeof(value);\n      if(valueType !== info.type){\n        throw new TypeError(type, valueType);\n      }\n      if(min !== false && value < min){\n        throw new RangeError('less than allowed minimum', value, min);\n      }\n      if(max !== false && value > max){\n        throw new RangeError('greater than allowed maximum', value, max);\n      }\n      return new Handler(Object.assign({}, this.props, {[key]: value}));\n    };\n  });\n\n  return Handler;\n};\n"]}